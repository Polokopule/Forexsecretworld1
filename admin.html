<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - Forex Secret World</title>
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
<script src="firebase.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Poppins', sans-serif; background: #f9f9f9; margin: 0; }
.header { background: radial-gradient(#fff,#ffd6d6); padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; }
.header h2 { margin: 0; color: #ff523b; }
.container { max-width: 1200px; margin: auto; padding: 20px; }
input, select, textarea, button { padding: 10px; margin: 5px 0; border-radius: 5px; border: 1px solid #ccc; width: 100%; }
textarea { resize: vertical; }
button { background: #ff523b; color: white; border: none; cursor: pointer; transition: 0.3s; }
button:hover { background: #563434; }
table { width: 100%; border-collapse: collapse; margin-top: 20px; }
th, td { padding: 10px; border-bottom: 1px solid #ccc; text-align: left; }
th { background: #ff523b; color: white; }
.product-image { width: 80px; height: 80px; object-fit: cover; border-radius: 5px; }
.tabs { display: flex; margin-bottom: 20px; }
.tab { padding: 10px 20px; cursor: pointer; border: 1px solid #ff523b; border-bottom: none; background: #fff; margin-right: 5px; border-top-left-radius: 5px; border-top-right-radius: 5px; }
.tab.active { background: #ff523b; color: #fff; }
.tab-content { display: none; background: #fff; padding: 20px; border: 1px solid #ff523b; border-radius: 5px; }
.tab-content.active { display: block; }
.toast { position: fixed; top: 20px; right: 20px; background: #ff523b; color: white; padding: 10px 20px; border-radius: 5px; display: none; z-index: 9999; }
</style>
</head>
<body>

<div class="header">
  <h2>Admin Panel</h2>
</div>

<div class="container">

  <!-- Tabs -->
  <div class="tabs">
    <div class="tab active" onclick="openTab('productsTab')">Existing Products</div>
    <div class="tab" onclick="openTab('pendingTab')">Pending Orders</div>
  </div>

  <!-- Existing Products Tab -->
  <div id="productsTab" class="tab-content active">
    <h3>Add / Update Product</h3>
    <input type="hidden" id="productId">
    <input type="text" id="productName" placeholder="Product Name">
    <textarea id="productDesc" placeholder="Product Description"></textarea>
    <input type="number" id="productPrice" placeholder="Price in USD">
    <input type="file" id="productImageFile">
    <select id="productCategory">
      <option value="">Select Category</option>
      <option value="books">Books</option>
      <option value="indicators">Indicators</option>
      <option value="robots">Robots</option>
      <option value="combos">Combos</option>
    </select>
    <button onclick="addOrUpdateProduct()">Add / Update Product</button>

    <h3>Existing Products</h3>
    <table id="productsTable">
      <thead>
        <tr>
          <th>Image</th>
          <th>Name</th>
          <th>Category</th>
          <th>Price</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Pending Orders Tab -->
  <div id="pendingTab" class="tab-content">
    <h3>Pending Orders</h3>
    <table id="ordersTable">
      <thead>
        <tr>
          <th>Order ID</th>
          <th>Customer</th>
          <th>Product</th>
          <th>Price</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

</div>

<div class="toast" id="toast"></div>

<script>
function openTab(tabId) {
  document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
  event.currentTarget.classList.add('active');
  document.getElementById(tabId).classList.add('active');
}


const toast = document.getElementById('toast');
function showToast(message) { toast.textContent = message; toast.style.display = 'block'; setTimeout(() => toast.style.display='none',3000); }

// Products CRUD (your existing code)
function addOrUpdateProduct() { /* ...existing code here... */ }
// Load products
db.ref('products').on('value', snapshot => {
  const tbody = document.querySelector('#productsTable tbody');
  tbody.innerHTML = '';
  snapshot.forEach(child => {
    const data = child.val();
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><img src="${data.image}" class="product-image"></td>
      <td>${data.name}</td>
      <td>${data.category}</td>
      <td>$${data.price}</td>
      <td>
        <button onclick="editProduct('${child.key}','${data.name}','${data.description}','${data.price}','${data.category}')">Edit</button>
        <button onclick="deleteProduct('${child.key}','${data.image}')">Delete</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
});

// Pending orders with customer email
db.ref('orders').orderByChild('status').equalTo('pending').on('value', snapshot => {
  const tbody = document.querySelector('#ordersTable tbody');
  tbody.innerHTML = '';
  snapshot.forEach(child => {
    const data = child.val();
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${child.key}</td>
      <td>${data.customerEmail || data.customerName}</td>
      <td>${data.productName}</td>
      <td>$${data.price}</td>
      <td>${data.status}</td>
      <td><button onclick="markOrderCompleted('${child.key}')">Mark Completed</button></td>
    `;
    tbody.appendChild(tr);
  });
});
// Mark order completed
function markOrderCompleted(orderId) {
  db.ref('orders/' + orderId).update({ status: 'completed' })
    .then(() => showToast('Order marked as completed'))
    .catch(err => showToast(err.message));
}
</script>

</body>
</html>